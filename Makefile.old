# -------------------------------------------------------
# This Makefile is automatically generated.  If you want to change the
# system, e.g. to add additional features, then edit the file
# generate_makefile.py instead.
# -------------------------------------------------------
data/deep/glove.840B.300d.txt.gz:
	mkdir -p data/deep
	curl http://www-nlp.stanford.edu/data/glove.840B.300d.txt.gz > $@

data/deep/params: data/deep/glove.840B.300d.txt.gz
	python3 guesser/util/format_dan.py --database=data/questions.db --threshold=5
	python3 guesser/util/load_embeddings.py
	python3 guesser/dan.py

data/kenlm.binary: extractors/mentions.py
	mkdir -p temp
	python3 extractors/mentions.py --build_lm_data
	lmplz -o 5 < temp/wiki_sent > data/kenlm.arpa
	build_binary data/kenlm.arpa $@
	rm temp/wiki_sent

data/classifier/category.pkl: util/classifier.py extractors/classifier.py
	mkdir -p data/classifier
	python3 util/classifier.py --attribute=category

data/classifier/ans_type.pkl: util/classifier.py extractors/classifier.py
	mkdir -p data/classifier
	python3 util/classifier.py --attribute=ans_type

data/classifier/gender.pkl: util/classifier.py extractors/classifier.py
	mkdir -p data/classifier
	python3 util/classifier.py --attribute=gender

data/wikifier/data/input/: util/wikification.py
	rm -rf $@
	mkdir -p $@
	python3 util/wikification.py

data/wikifier/data/output: data/wikifier/data/input
	rm -rf $@
	mkdir -p $@
	cp lib/wikifier-3.0-jar-with-dependencies.jar data/wikifier/wikifier-3.0-jar-with-dependencies.jar
	cp lib/STAND_ALONE_GUROBI.xml data/wikifier/STAND_ALONE_GUROBI.xml
	(cd data/wikifier && java -Xmx10G -jar wikifier-3.0-jar-with-dependencies.jar -annotateData data/input data/output false STAND_ALONE_GUROBI.xml)

data/ir/whoosh_wiki_5/: util/build_whoosh.py
	rm -rf $@
	mkdir -p $@
	mkdir -p data/wikipedia
	python3 util/build_whoosh.py --min_answers=5 --whoosh_index=$@ --use_wiki

data/ir/whoosh_qb_5/: util/build_whoosh.py
	rm -rf $@
	mkdir -p $@
	python3 util/build_whoosh.py --whoosh_index=$@ --min_answers=5 --use_qb

data/ir/whoosh_source_5/: util/build_whoosh.py
	rm -rf $@
	mkdir -p $@
	python3 util/build_whoosh.py --whoosh_index=$@ --min_answers=5 --use_source

data/guesses.db: extract_features.py data/deep/params
	rm data/temp_guesses.db
	python3 extract_features.py --guesses --ans_limit=5 --guess_db=data/temp_guesses.db
	cp data/temp_guesses.db $@


clm/clm_wrap.cxx: clm/clm.swig
	swig -c++ -python $<

clm/clm_wrap.o: clm/clm_wrap.cxx
	gcc -O3 `python3-config --includes` -fPIC -c $< -o $@

clm/clm.o: clm/clm.cpp clm/clm.h
	gcc -O3 `python3-config --includes` -fPIC -c $< -o $@

clm/_clm.so: clm/clm.o clm/clm_wrap.o
	g++ -shared `python3-config --ldflags` $^ -o $@

data/lm.txt: clm/lm_wrapper.py clm/_clm.so
	mkdir -p data/wikipedia
	python3 run_clm.py --min_answers=5

data/features/dev/sentence.ir.parquet/_SUCCESS data/features/dev/sentence.deep.parquet/_SUCCESS data/features/dev/sentence.answer_present.parquet/_SUCCESS data/features/dev/sentence.classifier.parquet/_SUCCESS data/features/dev/sentence.wikilinks.parquet/_SUCCESS data/features/dev/sentence.label.parquet/_SUCCESS data/features/devtest/sentence.ir.parquet/_SUCCESS data/features/devtest/sentence.deep.parquet/_SUCCESS data/features/devtest/sentence.answer_present.parquet/_SUCCESS data/features/devtest/sentence.classifier.parquet/_SUCCESS data/features/devtest/sentence.wikilinks.parquet/_SUCCESS data/features/devtest/sentence.label.parquet/_SUCCESS data/features/test/sentence.ir.parquet/_SUCCESS data/features/test/sentence.deep.parquet/_SUCCESS data/features/test/sentence.answer_present.parquet/_SUCCESS data/features/test/sentence.classifier.parquet/_SUCCESS data/features/test/sentence.wikilinks.parquet/_SUCCESS data/features/test/sentence.label.parquet/_SUCCESS : extract_features.py  extractors/ir.py data/ir/whoosh_wiki_5 data/ir/whoosh_qb_5 data/guesses.db extractors/deep.py data/guesses.db extractors/answer_present.py data/guesses.db extractors/classifier.py data/classifier/category.pkl data/classifier/ans_type.pkl data/classifier/gender.pkl data/guesses.db extractors/wikilinks.py data/wikifier/data/output data/guesses.db extractors/label.py data/guesses.db
    # Note, you may have to split these into 2 runs if out of memory errors occur
	python3 run_spark.py extract_features ir deep answer_present classifier wikilinks label

extract_compute_features: data/features/dev/sentence.ir.parquet/_SUCCESS data/features/dev/sentence.deep.parquet/_SUCCESS data/features/dev/sentence.answer_present.parquet/_SUCCESS data/features/dev/sentence.classifier.parquet/_SUCCESS data/features/dev/sentence.wikilinks.parquet/_SUCCESS data/features/dev/sentence.label.parquet/_SUCCESS data/features/devtest/sentence.ir.parquet/_SUCCESS data/features/devtest/sentence.deep.parquet/_SUCCESS data/features/devtest/sentence.answer_present.parquet/_SUCCESS data/features/devtest/sentence.classifier.parquet/_SUCCESS data/features/devtest/sentence.wikilinks.parquet/_SUCCESS data/features/devtest/sentence.label.parquet/_SUCCESS data/features/test/sentence.ir.parquet/_SUCCESS data/features/test/sentence.deep.parquet/_SUCCESS data/features/test/sentence.answer_present.parquet/_SUCCESS data/features/test/sentence.classifier.parquet/_SUCCESS data/features/test/sentence.wikilinks.parquet/_SUCCESS data/features/test/sentence.label.parquet/_SUCCESS

data/features/dev/sentence.lm.parquet/_SUCCESS data/features/dev/sentence.mentions.parquet/_SUCCESS data/features/devtest/sentence.lm.parquet/_SUCCESS data/features/devtest/sentence.mentions.parquet/_SUCCESS data/features/test/sentence.lm.parquet/_SUCCESS data/features/test/sentence.mentions.parquet/_SUCCESS : extract_features.py  extractors/lm.py data/lm.txt data/guesses.db extractors/mentions.py data/kenlm.binary data/guesses.db
    # Note, you may have to split these into 2 runs if out of memory errors occur
	python3 run_spark.py extract_features --lm-memory lm mentions

extract_memory_features: data/features/dev/sentence.lm.parquet/_SUCCESS data/features/dev/sentence.mentions.parquet/_SUCCESS data/features/devtest/sentence.lm.parquet/_SUCCESS data/features/devtest/sentence.mentions.parquet/_SUCCESS data/features/test/sentence.lm.parquet/_SUCCESS data/features/test/sentence.mentions.parquet/_SUCCESS

extract_features: extract_compute_features extract_memory_features


data/vw_input/dev/sentence.2.vw_input/_SUCCESS data/vw_input/dev/sentence.4.vw_input/_SUCCESS data/vw_input/dev/sentence.8.vw_input/_SUCCESS data/vw_input/dev/sentence.16.vw_input/_SUCCESS data/vw_input/dev/sentence.32.vw_input/_SUCCESS data/vw_input/dev/sentence.64.vw_input/_SUCCESS data/vw_input/devtest/sentence.2.vw_input/_SUCCESS data/vw_input/devtest/sentence.4.vw_input/_SUCCESS data/vw_input/devtest/sentence.8.vw_input/_SUCCESS data/vw_input/devtest/sentence.16.vw_input/_SUCCESS data/vw_input/devtest/sentence.32.vw_input/_SUCCESS data/vw_input/devtest/sentence.64.vw_input/_SUCCESS data/vw_input/test/sentence.2.vw_input/_SUCCESS data/vw_input/test/sentence.4.vw_input/_SUCCESS data/vw_input/test/sentence.8.vw_input/_SUCCESS data/vw_input/test/sentence.16.vw_input/_SUCCESS data/vw_input/test/sentence.32.vw_input/_SUCCESS data/vw_input/test/sentence.64.vw_input/_SUCCESS : data/features/dev/sentence.label.parquet/_SUCCESS data/features/dev/sentence.ir.parquet/_SUCCESS data/features/dev/sentence.lm.parquet/_SUCCESS data/features/dev/sentence.mentions.parquet/_SUCCESS data/features/dev/sentence.deep.parquet/_SUCCESS data/features/dev/sentence.answer_present.parquet/_SUCCESS data/features/dev/sentence.classifier.parquet/_SUCCESS data/features/dev/sentence.wikilinks.parquet/_SUCCESS data/features/devtest/sentence.label.parquet/_SUCCESS data/features/devtest/sentence.ir.parquet/_SUCCESS data/features/devtest/sentence.lm.parquet/_SUCCESS data/features/devtest/sentence.mentions.parquet/_SUCCESS data/features/devtest/sentence.deep.parquet/_SUCCESS data/features/devtest/sentence.answer_present.parquet/_SUCCESS data/features/devtest/sentence.classifier.parquet/_SUCCESS data/features/devtest/sentence.wikilinks.parquet/_SUCCESS data/features/test/sentence.label.parquet/_SUCCESS data/features/test/sentence.ir.parquet/_SUCCESS data/features/test/sentence.lm.parquet/_SUCCESS data/features/test/sentence.mentions.parquet/_SUCCESS data/features/test/sentence.deep.parquet/_SUCCESS data/features/test/sentence.answer_present.parquet/_SUCCESS data/features/test/sentence.classifier.parquet/_SUCCESS data/features/test/sentence.wikilinks.parquet/_SUCCESS
	python3 run_spark.py merge_features

spark_merge_features: data/vw_input/dev/sentence.2.vw_input/_SUCCESS data/vw_input/dev/sentence.4.vw_input/_SUCCESS data/vw_input/dev/sentence.8.vw_input/_SUCCESS data/vw_input/dev/sentence.16.vw_input/_SUCCESS data/vw_input/dev/sentence.32.vw_input/_SUCCESS data/vw_input/dev/sentence.64.vw_input/_SUCCESS data/vw_input/devtest/sentence.2.vw_input/_SUCCESS data/vw_input/devtest/sentence.4.vw_input/_SUCCESS data/vw_input/devtest/sentence.8.vw_input/_SUCCESS data/vw_input/devtest/sentence.16.vw_input/_SUCCESS data/vw_input/devtest/sentence.32.vw_input/_SUCCESS data/vw_input/devtest/sentence.64.vw_input/_SUCCESS data/vw_input/test/sentence.2.vw_input/_SUCCESS data/vw_input/test/sentence.4.vw_input/_SUCCESS data/vw_input/test/sentence.8.vw_input/_SUCCESS data/vw_input/test/sentence.16.vw_input/_SUCCESS data/vw_input/test/sentence.32.vw_input/_SUCCESS data/vw_input/test/sentence.64.vw_input/_SUCCESS 


data/vw_input/dev.sentence.2.vw_input.gz: data/vw_input/dev/sentence.2.vw_input/_SUCCESS
	rm -f data/vw_input/dev.sentence.2.vw_input.gz
	rm -f data/vw_input/dev.sentence.2.vw_input
	rm -f data/vw_input/dev.sentence.2.meta
	cat data/vw_input/dev/sentence.2.vw_input/* | python3 util/split_feature_meta.py data/vw_input/dev.sentence.2.vw_input data/vw_input/dev.sentence.2.meta
	cat data/vw_input/dev.sentence.2.vw_input | gzip > data/vw_input/dev.sentence.2.vw_input.gz
	rm -f data/vw_input/dev.sentence.2.vw_input

data/vw_input/dev.sentence.4.vw_input.gz: data/vw_input/dev/sentence.4.vw_input/_SUCCESS
	rm -f data/vw_input/dev.sentence.4.vw_input.gz
	rm -f data/vw_input/dev.sentence.4.vw_input
	rm -f data/vw_input/dev.sentence.4.meta
	cat data/vw_input/dev/sentence.4.vw_input/* | python3 util/split_feature_meta.py data/vw_input/dev.sentence.4.vw_input data/vw_input/dev.sentence.4.meta
	cat data/vw_input/dev.sentence.4.vw_input | gzip > data/vw_input/dev.sentence.4.vw_input.gz
	rm -f data/vw_input/dev.sentence.4.vw_input

data/vw_input/dev.sentence.8.vw_input.gz: data/vw_input/dev/sentence.8.vw_input/_SUCCESS
	rm -f data/vw_input/dev.sentence.8.vw_input.gz
	rm -f data/vw_input/dev.sentence.8.vw_input
	rm -f data/vw_input/dev.sentence.8.meta
	cat data/vw_input/dev/sentence.8.vw_input/* | python3 util/split_feature_meta.py data/vw_input/dev.sentence.8.vw_input data/vw_input/dev.sentence.8.meta
	cat data/vw_input/dev.sentence.8.vw_input | gzip > data/vw_input/dev.sentence.8.vw_input.gz
	rm -f data/vw_input/dev.sentence.8.vw_input

data/vw_input/dev.sentence.16.vw_input.gz: data/vw_input/dev/sentence.16.vw_input/_SUCCESS
	rm -f data/vw_input/dev.sentence.16.vw_input.gz
	rm -f data/vw_input/dev.sentence.16.vw_input
	rm -f data/vw_input/dev.sentence.16.meta
	cat data/vw_input/dev/sentence.16.vw_input/* | python3 util/split_feature_meta.py data/vw_input/dev.sentence.16.vw_input data/vw_input/dev.sentence.16.meta
	cat data/vw_input/dev.sentence.16.vw_input | gzip > data/vw_input/dev.sentence.16.vw_input.gz
	rm -f data/vw_input/dev.sentence.16.vw_input

data/vw_input/dev.sentence.32.vw_input.gz: data/vw_input/dev/sentence.32.vw_input/_SUCCESS
	rm -f data/vw_input/dev.sentence.32.vw_input.gz
	rm -f data/vw_input/dev.sentence.32.vw_input
	rm -f data/vw_input/dev.sentence.32.meta
	cat data/vw_input/dev/sentence.32.vw_input/* | python3 util/split_feature_meta.py data/vw_input/dev.sentence.32.vw_input data/vw_input/dev.sentence.32.meta
	cat data/vw_input/dev.sentence.32.vw_input | gzip > data/vw_input/dev.sentence.32.vw_input.gz
	rm -f data/vw_input/dev.sentence.32.vw_input

data/vw_input/dev.sentence.64.vw_input.gz: data/vw_input/dev/sentence.64.vw_input/_SUCCESS
	rm -f data/vw_input/dev.sentence.64.vw_input.gz
	rm -f data/vw_input/dev.sentence.64.vw_input
	rm -f data/vw_input/dev.sentence.64.meta
	cat data/vw_input/dev/sentence.64.vw_input/* | python3 util/split_feature_meta.py data/vw_input/dev.sentence.64.vw_input data/vw_input/dev.sentence.64.meta
	cat data/vw_input/dev.sentence.64.vw_input | gzip > data/vw_input/dev.sentence.64.vw_input.gz
	rm -f data/vw_input/dev.sentence.64.vw_input

data/vw_input/devtest.sentence.2.vw_input.gz: data/vw_input/devtest/sentence.2.vw_input/_SUCCESS
	rm -f data/vw_input/devtest.sentence.2.vw_input.gz
	rm -f data/vw_input/devtest.sentence.2.vw_input
	rm -f data/vw_input/devtest.sentence.2.meta
	cat data/vw_input/devtest/sentence.2.vw_input/* | python3 util/split_feature_meta.py data/vw_input/devtest.sentence.2.vw_input data/vw_input/devtest.sentence.2.meta
	cat data/vw_input/devtest.sentence.2.vw_input | gzip > data/vw_input/devtest.sentence.2.vw_input.gz
	rm -f data/vw_input/devtest.sentence.2.vw_input

data/vw_input/devtest.sentence.4.vw_input.gz: data/vw_input/devtest/sentence.4.vw_input/_SUCCESS
	rm -f data/vw_input/devtest.sentence.4.vw_input.gz
	rm -f data/vw_input/devtest.sentence.4.vw_input
	rm -f data/vw_input/devtest.sentence.4.meta
	cat data/vw_input/devtest/sentence.4.vw_input/* | python3 util/split_feature_meta.py data/vw_input/devtest.sentence.4.vw_input data/vw_input/devtest.sentence.4.meta
	cat data/vw_input/devtest.sentence.4.vw_input | gzip > data/vw_input/devtest.sentence.4.vw_input.gz
	rm -f data/vw_input/devtest.sentence.4.vw_input

data/vw_input/devtest.sentence.8.vw_input.gz: data/vw_input/devtest/sentence.8.vw_input/_SUCCESS
	rm -f data/vw_input/devtest.sentence.8.vw_input.gz
	rm -f data/vw_input/devtest.sentence.8.vw_input
	rm -f data/vw_input/devtest.sentence.8.meta
	cat data/vw_input/devtest/sentence.8.vw_input/* | python3 util/split_feature_meta.py data/vw_input/devtest.sentence.8.vw_input data/vw_input/devtest.sentence.8.meta
	cat data/vw_input/devtest.sentence.8.vw_input | gzip > data/vw_input/devtest.sentence.8.vw_input.gz
	rm -f data/vw_input/devtest.sentence.8.vw_input

data/vw_input/devtest.sentence.16.vw_input.gz: data/vw_input/devtest/sentence.16.vw_input/_SUCCESS
	rm -f data/vw_input/devtest.sentence.16.vw_input.gz
	rm -f data/vw_input/devtest.sentence.16.vw_input
	rm -f data/vw_input/devtest.sentence.16.meta
	cat data/vw_input/devtest/sentence.16.vw_input/* | python3 util/split_feature_meta.py data/vw_input/devtest.sentence.16.vw_input data/vw_input/devtest.sentence.16.meta
	cat data/vw_input/devtest.sentence.16.vw_input | gzip > data/vw_input/devtest.sentence.16.vw_input.gz
	rm -f data/vw_input/devtest.sentence.16.vw_input

data/vw_input/devtest.sentence.32.vw_input.gz: data/vw_input/devtest/sentence.32.vw_input/_SUCCESS
	rm -f data/vw_input/devtest.sentence.32.vw_input.gz
	rm -f data/vw_input/devtest.sentence.32.vw_input
	rm -f data/vw_input/devtest.sentence.32.meta
	cat data/vw_input/devtest/sentence.32.vw_input/* | python3 util/split_feature_meta.py data/vw_input/devtest.sentence.32.vw_input data/vw_input/devtest.sentence.32.meta
	cat data/vw_input/devtest.sentence.32.vw_input | gzip > data/vw_input/devtest.sentence.32.vw_input.gz
	rm -f data/vw_input/devtest.sentence.32.vw_input

data/vw_input/devtest.sentence.64.vw_input.gz: data/vw_input/devtest/sentence.64.vw_input/_SUCCESS
	rm -f data/vw_input/devtest.sentence.64.vw_input.gz
	rm -f data/vw_input/devtest.sentence.64.vw_input
	rm -f data/vw_input/devtest.sentence.64.meta
	cat data/vw_input/devtest/sentence.64.vw_input/* | python3 util/split_feature_meta.py data/vw_input/devtest.sentence.64.vw_input data/vw_input/devtest.sentence.64.meta
	cat data/vw_input/devtest.sentence.64.vw_input | gzip > data/vw_input/devtest.sentence.64.vw_input.gz
	rm -f data/vw_input/devtest.sentence.64.vw_input

data/vw_input/test.sentence.2.vw_input.gz: data/vw_input/test/sentence.2.vw_input/_SUCCESS
	rm -f data/vw_input/test.sentence.2.vw_input.gz
	rm -f data/vw_input/test.sentence.2.vw_input
	rm -f data/vw_input/test.sentence.2.meta
	cat data/vw_input/test/sentence.2.vw_input/* | python3 util/split_feature_meta.py data/vw_input/test.sentence.2.vw_input data/vw_input/test.sentence.2.meta
	cat data/vw_input/test.sentence.2.vw_input | gzip > data/vw_input/test.sentence.2.vw_input.gz
	rm -f data/vw_input/test.sentence.2.vw_input

data/vw_input/test.sentence.4.vw_input.gz: data/vw_input/test/sentence.4.vw_input/_SUCCESS
	rm -f data/vw_input/test.sentence.4.vw_input.gz
	rm -f data/vw_input/test.sentence.4.vw_input
	rm -f data/vw_input/test.sentence.4.meta
	cat data/vw_input/test/sentence.4.vw_input/* | python3 util/split_feature_meta.py data/vw_input/test.sentence.4.vw_input data/vw_input/test.sentence.4.meta
	cat data/vw_input/test.sentence.4.vw_input | gzip > data/vw_input/test.sentence.4.vw_input.gz
	rm -f data/vw_input/test.sentence.4.vw_input

data/vw_input/test.sentence.8.vw_input.gz: data/vw_input/test/sentence.8.vw_input/_SUCCESS
	rm -f data/vw_input/test.sentence.8.vw_input.gz
	rm -f data/vw_input/test.sentence.8.vw_input
	rm -f data/vw_input/test.sentence.8.meta
	cat data/vw_input/test/sentence.8.vw_input/* | python3 util/split_feature_meta.py data/vw_input/test.sentence.8.vw_input data/vw_input/test.sentence.8.meta
	cat data/vw_input/test.sentence.8.vw_input | gzip > data/vw_input/test.sentence.8.vw_input.gz
	rm -f data/vw_input/test.sentence.8.vw_input

data/vw_input/test.sentence.16.vw_input.gz: data/vw_input/test/sentence.16.vw_input/_SUCCESS
	rm -f data/vw_input/test.sentence.16.vw_input.gz
	rm -f data/vw_input/test.sentence.16.vw_input
	rm -f data/vw_input/test.sentence.16.meta
	cat data/vw_input/test/sentence.16.vw_input/* | python3 util/split_feature_meta.py data/vw_input/test.sentence.16.vw_input data/vw_input/test.sentence.16.meta
	cat data/vw_input/test.sentence.16.vw_input | gzip > data/vw_input/test.sentence.16.vw_input.gz
	rm -f data/vw_input/test.sentence.16.vw_input

data/vw_input/test.sentence.32.vw_input.gz: data/vw_input/test/sentence.32.vw_input/_SUCCESS
	rm -f data/vw_input/test.sentence.32.vw_input.gz
	rm -f data/vw_input/test.sentence.32.vw_input
	rm -f data/vw_input/test.sentence.32.meta
	cat data/vw_input/test/sentence.32.vw_input/* | python3 util/split_feature_meta.py data/vw_input/test.sentence.32.vw_input data/vw_input/test.sentence.32.meta
	cat data/vw_input/test.sentence.32.vw_input | gzip > data/vw_input/test.sentence.32.vw_input.gz
	rm -f data/vw_input/test.sentence.32.vw_input

data/vw_input/test.sentence.64.vw_input.gz: data/vw_input/test/sentence.64.vw_input/_SUCCESS
	rm -f data/vw_input/test.sentence.64.vw_input.gz
	rm -f data/vw_input/test.sentence.64.vw_input
	rm -f data/vw_input/test.sentence.64.meta
	cat data/vw_input/test/sentence.64.vw_input/* | python3 util/split_feature_meta.py data/vw_input/test.sentence.64.vw_input data/vw_input/test.sentence.64.meta
	cat data/vw_input/test.sentence.64.vw_input | gzip > data/vw_input/test.sentence.64.vw_input.gz
	rm -f data/vw_input/test.sentence.64.vw_input


merge_features: data/vw_input/dev.sentence.2.vw_input.gz data/vw_input/dev.sentence.4.vw_input.gz data/vw_input/dev.sentence.8.vw_input.gz data/vw_input/dev.sentence.16.vw_input.gz data/vw_input/dev.sentence.32.vw_input.gz data/vw_input/dev.sentence.64.vw_input.gz data/vw_input/devtest.sentence.2.vw_input.gz data/vw_input/devtest.sentence.4.vw_input.gz data/vw_input/devtest.sentence.8.vw_input.gz data/vw_input/devtest.sentence.16.vw_input.gz data/vw_input/devtest.sentence.32.vw_input.gz data/vw_input/devtest.sentence.64.vw_input.gz data/vw_input/test.sentence.2.vw_input.gz data/vw_input/test.sentence.4.vw_input.gz data/vw_input/test.sentence.8.vw_input.gz data/vw_input/test.sentence.16.vw_input.gz data/vw_input/test.sentence.32.vw_input.gz data/vw_input/test.sentence.64.vw_input.gz


data/models/sentence.full.2.vw: data/vw_input/dev.sentence.2.vw_input.gz
	mkdir -p data/models
	vw --compressed -d $< --early_terminate 100 -k -q gt -q ga -b 28 --loss_function logistic -f $@

data/results/dev/sentence.2.full.pred: data/vw_input/dev.sentence.2.vw_input.gz data/models/sentence.full.2.vw
	mkdir -p data/results/dev
	vw --compressed -t -d data/vw_input/dev.sentence.2.vw_input.gz -i data/models/sentence.full.2.vw -p $@

data/results/dev/sentence.2.summary.json: data/results/dev/sentence.2.full.pred data/vw_input/dev.sentence.2.meta
	python3 qanta/reporting/performance.py generate data/results/dev/sentence.2.full.pred data/vw_input/dev.sentence.2.meta data/results/dev/sentence.2.summary.json

data/results/devtest/sentence.2.full.pred: data/vw_input/devtest.sentence.2.vw_input.gz data/models/sentence.full.2.vw
	mkdir -p data/results/devtest
	vw --compressed -t -d data/vw_input/devtest.sentence.2.vw_input.gz -i data/models/sentence.full.2.vw -p $@

data/results/devtest/sentence.2.summary.json: data/results/devtest/sentence.2.full.pred data/vw_input/devtest.sentence.2.meta
	python3 qanta/reporting/performance.py generate data/results/devtest/sentence.2.full.pred data/vw_input/devtest.sentence.2.meta data/results/devtest/sentence.2.summary.json

data/results/test/sentence.2.full.pred: data/vw_input/test.sentence.2.vw_input.gz data/models/sentence.full.2.vw
	mkdir -p data/results/test
	vw --compressed -t -d data/vw_input/test.sentence.2.vw_input.gz -i data/models/sentence.full.2.vw -p $@

data/results/test/sentence.2.summary.json: data/results/test/sentence.2.full.pred data/vw_input/test.sentence.2.meta
	python3 qanta/reporting/performance.py generate data/results/test/sentence.2.full.pred data/vw_input/test.sentence.2.meta data/results/test/sentence.2.summary.json


data/models/sentence.full.4.vw: data/vw_input/dev.sentence.4.vw_input.gz
	mkdir -p data/models
	vw --compressed -d $< --early_terminate 100 -k -q gt -q ga -b 28 --loss_function logistic -f $@

data/results/dev/sentence.4.full.pred: data/vw_input/dev.sentence.4.vw_input.gz data/models/sentence.full.4.vw
	mkdir -p data/results/dev
	vw --compressed -t -d data/vw_input/dev.sentence.4.vw_input.gz -i data/models/sentence.full.4.vw -p $@

data/results/dev/sentence.4.summary.json: data/results/dev/sentence.4.full.pred data/vw_input/dev.sentence.4.meta
	python3 qanta/reporting/performance.py generate data/results/dev/sentence.4.full.pred data/vw_input/dev.sentence.4.meta data/results/dev/sentence.4.summary.json

data/results/devtest/sentence.4.full.pred: data/vw_input/devtest.sentence.4.vw_input.gz data/models/sentence.full.4.vw
	mkdir -p data/results/devtest
	vw --compressed -t -d data/vw_input/devtest.sentence.4.vw_input.gz -i data/models/sentence.full.4.vw -p $@

data/results/devtest/sentence.4.summary.json: data/results/devtest/sentence.4.full.pred data/vw_input/devtest.sentence.4.meta
	python3 qanta/reporting/performance.py generate data/results/devtest/sentence.4.full.pred data/vw_input/devtest.sentence.4.meta data/results/devtest/sentence.4.summary.json

data/results/test/sentence.4.full.pred: data/vw_input/test.sentence.4.vw_input.gz data/models/sentence.full.4.vw
	mkdir -p data/results/test
	vw --compressed -t -d data/vw_input/test.sentence.4.vw_input.gz -i data/models/sentence.full.4.vw -p $@

data/results/test/sentence.4.summary.json: data/results/test/sentence.4.full.pred data/vw_input/test.sentence.4.meta
	python3 qanta/reporting/performance.py generate data/results/test/sentence.4.full.pred data/vw_input/test.sentence.4.meta data/results/test/sentence.4.summary.json


data/models/sentence.full.8.vw: data/vw_input/dev.sentence.8.vw_input.gz
	mkdir -p data/models
	vw --compressed -d $< --early_terminate 100 -k -q gt -q ga -b 28 --loss_function logistic -f $@

data/results/dev/sentence.8.full.pred: data/vw_input/dev.sentence.8.vw_input.gz data/models/sentence.full.8.vw
	mkdir -p data/results/dev
	vw --compressed -t -d data/vw_input/dev.sentence.8.vw_input.gz -i data/models/sentence.full.8.vw -p $@

data/results/dev/sentence.8.summary.json: data/results/dev/sentence.8.full.pred data/vw_input/dev.sentence.8.meta
	python3 qanta/reporting/performance.py generate data/results/dev/sentence.8.full.pred data/vw_input/dev.sentence.8.meta data/results/dev/sentence.8.summary.json

data/results/devtest/sentence.8.full.pred: data/vw_input/devtest.sentence.8.vw_input.gz data/models/sentence.full.8.vw
	mkdir -p data/results/devtest
	vw --compressed -t -d data/vw_input/devtest.sentence.8.vw_input.gz -i data/models/sentence.full.8.vw -p $@

data/results/devtest/sentence.8.summary.json: data/results/devtest/sentence.8.full.pred data/vw_input/devtest.sentence.8.meta
	python3 qanta/reporting/performance.py generate data/results/devtest/sentence.8.full.pred data/vw_input/devtest.sentence.8.meta data/results/devtest/sentence.8.summary.json

data/results/test/sentence.8.full.pred: data/vw_input/test.sentence.8.vw_input.gz data/models/sentence.full.8.vw
	mkdir -p data/results/test
	vw --compressed -t -d data/vw_input/test.sentence.8.vw_input.gz -i data/models/sentence.full.8.vw -p $@

data/results/test/sentence.8.summary.json: data/results/test/sentence.8.full.pred data/vw_input/test.sentence.8.meta
	python3 qanta/reporting/performance.py generate data/results/test/sentence.8.full.pred data/vw_input/test.sentence.8.meta data/results/test/sentence.8.summary.json


data/models/sentence.full.16.vw: data/vw_input/dev.sentence.16.vw_input.gz
	mkdir -p data/models
	vw --compressed -d $< --early_terminate 100 -k -q gt -q ga -b 28 --loss_function logistic -f $@

data/results/dev/sentence.16.full.pred: data/vw_input/dev.sentence.16.vw_input.gz data/models/sentence.full.16.vw
	mkdir -p data/results/dev
	vw --compressed -t -d data/vw_input/dev.sentence.16.vw_input.gz -i data/models/sentence.full.16.vw -p $@

data/results/dev/sentence.16.summary.json: data/results/dev/sentence.16.full.pred data/vw_input/dev.sentence.16.meta
	python3 qanta/reporting/performance.py generate data/results/dev/sentence.16.full.pred data/vw_input/dev.sentence.16.meta data/results/dev/sentence.16.summary.json

data/results/devtest/sentence.16.full.pred: data/vw_input/devtest.sentence.16.vw_input.gz data/models/sentence.full.16.vw
	mkdir -p data/results/devtest
	vw --compressed -t -d data/vw_input/devtest.sentence.16.vw_input.gz -i data/models/sentence.full.16.vw -p $@

data/results/devtest/sentence.16.summary.json: data/results/devtest/sentence.16.full.pred data/vw_input/devtest.sentence.16.meta
	python3 qanta/reporting/performance.py generate data/results/devtest/sentence.16.full.pred data/vw_input/devtest.sentence.16.meta data/results/devtest/sentence.16.summary.json

data/results/test/sentence.16.full.pred: data/vw_input/test.sentence.16.vw_input.gz data/models/sentence.full.16.vw
	mkdir -p data/results/test
	vw --compressed -t -d data/vw_input/test.sentence.16.vw_input.gz -i data/models/sentence.full.16.vw -p $@

data/results/test/sentence.16.summary.json: data/results/test/sentence.16.full.pred data/vw_input/test.sentence.16.meta
	python3 qanta/reporting/performance.py generate data/results/test/sentence.16.full.pred data/vw_input/test.sentence.16.meta data/results/test/sentence.16.summary.json


data/models/sentence.full.32.vw: data/vw_input/dev.sentence.32.vw_input.gz
	mkdir -p data/models
	vw --compressed -d $< --early_terminate 100 -k -q gt -q ga -b 28 --loss_function logistic -f $@

data/results/dev/sentence.32.full.pred: data/vw_input/dev.sentence.32.vw_input.gz data/models/sentence.full.32.vw
	mkdir -p data/results/dev
	vw --compressed -t -d data/vw_input/dev.sentence.32.vw_input.gz -i data/models/sentence.full.32.vw -p $@

data/results/dev/sentence.32.summary.json: data/results/dev/sentence.32.full.pred data/vw_input/dev.sentence.32.meta
	python3 qanta/reporting/performance.py generate data/results/dev/sentence.32.full.pred data/vw_input/dev.sentence.32.meta data/results/dev/sentence.32.summary.json

data/results/devtest/sentence.32.full.pred: data/vw_input/devtest.sentence.32.vw_input.gz data/models/sentence.full.32.vw
	mkdir -p data/results/devtest
	vw --compressed -t -d data/vw_input/devtest.sentence.32.vw_input.gz -i data/models/sentence.full.32.vw -p $@

data/results/devtest/sentence.32.summary.json: data/results/devtest/sentence.32.full.pred data/vw_input/devtest.sentence.32.meta
	python3 qanta/reporting/performance.py generate data/results/devtest/sentence.32.full.pred data/vw_input/devtest.sentence.32.meta data/results/devtest/sentence.32.summary.json

data/results/test/sentence.32.full.pred: data/vw_input/test.sentence.32.vw_input.gz data/models/sentence.full.32.vw
	mkdir -p data/results/test
	vw --compressed -t -d data/vw_input/test.sentence.32.vw_input.gz -i data/models/sentence.full.32.vw -p $@

data/results/test/sentence.32.summary.json: data/results/test/sentence.32.full.pred data/vw_input/test.sentence.32.meta
	python3 qanta/reporting/performance.py generate data/results/test/sentence.32.full.pred data/vw_input/test.sentence.32.meta data/results/test/sentence.32.summary.json


data/models/sentence.full.64.vw: data/vw_input/dev.sentence.64.vw_input.gz
	mkdir -p data/models
	vw --compressed -d $< --early_terminate 100 -k -q gt -q ga -b 28 --loss_function logistic -f $@

data/results/dev/sentence.64.full.pred: data/vw_input/dev.sentence.64.vw_input.gz data/models/sentence.full.64.vw
	mkdir -p data/results/dev
	vw --compressed -t -d data/vw_input/dev.sentence.64.vw_input.gz -i data/models/sentence.full.64.vw -p $@

data/results/dev/sentence.64.summary.json: data/results/dev/sentence.64.full.pred data/vw_input/dev.sentence.64.meta
	python3 qanta/reporting/performance.py generate data/results/dev/sentence.64.full.pred data/vw_input/dev.sentence.64.meta data/results/dev/sentence.64.summary.json

data/results/devtest/sentence.64.full.pred: data/vw_input/devtest.sentence.64.vw_input.gz data/models/sentence.full.64.vw
	mkdir -p data/results/devtest
	vw --compressed -t -d data/vw_input/devtest.sentence.64.vw_input.gz -i data/models/sentence.full.64.vw -p $@

data/results/devtest/sentence.64.summary.json: data/results/devtest/sentence.64.full.pred data/vw_input/devtest.sentence.64.meta
	python3 qanta/reporting/performance.py generate data/results/devtest/sentence.64.full.pred data/vw_input/devtest.sentence.64.meta data/results/devtest/sentence.64.summary.json

data/results/test/sentence.64.full.pred: data/vw_input/test.sentence.64.vw_input.gz data/models/sentence.full.64.vw
	mkdir -p data/results/test
	vw --compressed -t -d data/vw_input/test.sentence.64.vw_input.gz -i data/models/sentence.full.64.vw -p $@

data/results/test/sentence.64.summary.json: data/results/test/sentence.64.full.pred data/vw_input/test.sentence.64.meta
	python3 qanta/reporting/performance.py generate data/results/test/sentence.64.full.pred data/vw_input/test.sentence.64.meta data/results/test/sentence.64.summary.json





data/results/test/sentence.2.-g.answer.json:
	./feature-ablation.sh 2 g

data/results/test/sentence.2.-i.answer.json:
	./feature-ablation.sh 2 i

data/results/test/sentence.2.-l.answer.json:
	./feature-ablation.sh 2 l

data/results/test/sentence.2.-m.answer.json:
	./feature-ablation.sh 2 m

data/results/test/sentence.2.-d.answer.json:
	./feature-ablation.sh 2 d

data/results/test/sentence.2.-a.answer.json:
	./feature-ablation.sh 2 a

data/results/test/sentence.2.-t.answer.json:
	./feature-ablation.sh 2 t

data/results/test/sentence.2.-w.answer.json:
	./feature-ablation.sh 2 w



data/results/test/sentence.4.-g.answer.json:
	./feature-ablation.sh 4 g

data/results/test/sentence.4.-i.answer.json:
	./feature-ablation.sh 4 i

data/results/test/sentence.4.-l.answer.json:
	./feature-ablation.sh 4 l

data/results/test/sentence.4.-m.answer.json:
	./feature-ablation.sh 4 m

data/results/test/sentence.4.-d.answer.json:
	./feature-ablation.sh 4 d

data/results/test/sentence.4.-a.answer.json:
	./feature-ablation.sh 4 a

data/results/test/sentence.4.-t.answer.json:
	./feature-ablation.sh 4 t

data/results/test/sentence.4.-w.answer.json:
	./feature-ablation.sh 4 w



data/results/test/sentence.8.-g.answer.json:
	./feature-ablation.sh 8 g

data/results/test/sentence.8.-i.answer.json:
	./feature-ablation.sh 8 i

data/results/test/sentence.8.-l.answer.json:
	./feature-ablation.sh 8 l

data/results/test/sentence.8.-m.answer.json:
	./feature-ablation.sh 8 m

data/results/test/sentence.8.-d.answer.json:
	./feature-ablation.sh 8 d

data/results/test/sentence.8.-a.answer.json:
	./feature-ablation.sh 8 a

data/results/test/sentence.8.-t.answer.json:
	./feature-ablation.sh 8 t

data/results/test/sentence.8.-w.answer.json:
	./feature-ablation.sh 8 w



data/results/test/sentence.16.-g.answer.json:
	./feature-ablation.sh 16 g

data/results/test/sentence.16.-i.answer.json:
	./feature-ablation.sh 16 i

data/results/test/sentence.16.-l.answer.json:
	./feature-ablation.sh 16 l

data/results/test/sentence.16.-m.answer.json:
	./feature-ablation.sh 16 m

data/results/test/sentence.16.-d.answer.json:
	./feature-ablation.sh 16 d

data/results/test/sentence.16.-a.answer.json:
	./feature-ablation.sh 16 a

data/results/test/sentence.16.-t.answer.json:
	./feature-ablation.sh 16 t

data/results/test/sentence.16.-w.answer.json:
	./feature-ablation.sh 16 w



data/results/test/sentence.32.-g.answer.json:
	./feature-ablation.sh 32 g

data/results/test/sentence.32.-i.answer.json:
	./feature-ablation.sh 32 i

data/results/test/sentence.32.-l.answer.json:
	./feature-ablation.sh 32 l

data/results/test/sentence.32.-m.answer.json:
	./feature-ablation.sh 32 m

data/results/test/sentence.32.-d.answer.json:
	./feature-ablation.sh 32 d

data/results/test/sentence.32.-a.answer.json:
	./feature-ablation.sh 32 a

data/results/test/sentence.32.-t.answer.json:
	./feature-ablation.sh 32 t

data/results/test/sentence.32.-w.answer.json:
	./feature-ablation.sh 32 w



data/results/test/sentence.64.-g.answer.json:
	./feature-ablation.sh 64 g

data/results/test/sentence.64.-i.answer.json:
	./feature-ablation.sh 64 i

data/results/test/sentence.64.-l.answer.json:
	./feature-ablation.sh 64 l

data/results/test/sentence.64.-m.answer.json:
	./feature-ablation.sh 64 m

data/results/test/sentence.64.-d.answer.json:
	./feature-ablation.sh 64 d

data/results/test/sentence.64.-a.answer.json:
	./feature-ablation.sh 64 a

data/results/test/sentence.64.-t.answer.json:
	./feature-ablation.sh 64 t

data/results/test/sentence.64.-w.answer.json:
	./feature-ablation.sh 64 w





data/results/test/sentence.2.g.answer.json:
	./feature-eval.sh 2 g

data/results/test/sentence.2.i.answer.json:
	./feature-eval.sh 2 i

data/results/test/sentence.2.l.answer.json:
	./feature-eval.sh 2 l

data/results/test/sentence.2.m.answer.json:
	./feature-eval.sh 2 m

data/results/test/sentence.2.d.answer.json:
	./feature-eval.sh 2 d

data/results/test/sentence.2.a.answer.json:
	./feature-eval.sh 2 a

data/results/test/sentence.2.t.answer.json:
	./feature-eval.sh 2 t

data/results/test/sentence.2.w.answer.json:
	./feature-eval.sh 2 w



data/results/test/sentence.4.g.answer.json:
	./feature-eval.sh 4 g

data/results/test/sentence.4.i.answer.json:
	./feature-eval.sh 4 i

data/results/test/sentence.4.l.answer.json:
	./feature-eval.sh 4 l

data/results/test/sentence.4.m.answer.json:
	./feature-eval.sh 4 m

data/results/test/sentence.4.d.answer.json:
	./feature-eval.sh 4 d

data/results/test/sentence.4.a.answer.json:
	./feature-eval.sh 4 a

data/results/test/sentence.4.t.answer.json:
	./feature-eval.sh 4 t

data/results/test/sentence.4.w.answer.json:
	./feature-eval.sh 4 w



data/results/test/sentence.8.g.answer.json:
	./feature-eval.sh 8 g

data/results/test/sentence.8.i.answer.json:
	./feature-eval.sh 8 i

data/results/test/sentence.8.l.answer.json:
	./feature-eval.sh 8 l

data/results/test/sentence.8.m.answer.json:
	./feature-eval.sh 8 m

data/results/test/sentence.8.d.answer.json:
	./feature-eval.sh 8 d

data/results/test/sentence.8.a.answer.json:
	./feature-eval.sh 8 a

data/results/test/sentence.8.t.answer.json:
	./feature-eval.sh 8 t

data/results/test/sentence.8.w.answer.json:
	./feature-eval.sh 8 w



data/results/test/sentence.16.g.answer.json:
	./feature-eval.sh 16 g

data/results/test/sentence.16.i.answer.json:
	./feature-eval.sh 16 i

data/results/test/sentence.16.l.answer.json:
	./feature-eval.sh 16 l

data/results/test/sentence.16.m.answer.json:
	./feature-eval.sh 16 m

data/results/test/sentence.16.d.answer.json:
	./feature-eval.sh 16 d

data/results/test/sentence.16.a.answer.json:
	./feature-eval.sh 16 a

data/results/test/sentence.16.t.answer.json:
	./feature-eval.sh 16 t

data/results/test/sentence.16.w.answer.json:
	./feature-eval.sh 16 w



data/results/test/sentence.32.g.answer.json:
	./feature-eval.sh 32 g

data/results/test/sentence.32.i.answer.json:
	./feature-eval.sh 32 i

data/results/test/sentence.32.l.answer.json:
	./feature-eval.sh 32 l

data/results/test/sentence.32.m.answer.json:
	./feature-eval.sh 32 m

data/results/test/sentence.32.d.answer.json:
	./feature-eval.sh 32 d

data/results/test/sentence.32.a.answer.json:
	./feature-eval.sh 32 a

data/results/test/sentence.32.t.answer.json:
	./feature-eval.sh 32 t

data/results/test/sentence.32.w.answer.json:
	./feature-eval.sh 32 w



data/results/test/sentence.64.g.answer.json:
	./feature-eval.sh 64 g

data/results/test/sentence.64.i.answer.json:
	./feature-eval.sh 64 i

data/results/test/sentence.64.l.answer.json:
	./feature-eval.sh 64 l

data/results/test/sentence.64.m.answer.json:
	./feature-eval.sh 64 m

data/results/test/sentence.64.d.answer.json:
	./feature-eval.sh 64 d

data/results/test/sentence.64.a.answer.json:
	./feature-eval.sh 64 a

data/results/test/sentence.64.t.answer.json:
	./feature-eval.sh 64 t

data/results/test/sentence.64.w.answer.json:
	./feature-eval.sh 64 w





data/results/test/sentence.2.lg.answer.json:
	./lm-eval.sh 2 g

data/results/test/sentence.2.li.answer.json:
	./lm-eval.sh 2 i

data/results/test/sentence.2.lm.answer.json:
	./lm-eval.sh 2 m

data/results/test/sentence.2.ld.answer.json:
	./lm-eval.sh 2 d

data/results/test/sentence.2.la.answer.json:
	./lm-eval.sh 2 a

data/results/test/sentence.2.lt.answer.json:
	./lm-eval.sh 2 t

data/results/test/sentence.2.lw.answer.json:
	./lm-eval.sh 2 w



data/results/test/sentence.4.lg.answer.json:
	./lm-eval.sh 4 g

data/results/test/sentence.4.li.answer.json:
	./lm-eval.sh 4 i

data/results/test/sentence.4.lm.answer.json:
	./lm-eval.sh 4 m

data/results/test/sentence.4.ld.answer.json:
	./lm-eval.sh 4 d

data/results/test/sentence.4.la.answer.json:
	./lm-eval.sh 4 a

data/results/test/sentence.4.lt.answer.json:
	./lm-eval.sh 4 t

data/results/test/sentence.4.lw.answer.json:
	./lm-eval.sh 4 w



data/results/test/sentence.8.lg.answer.json:
	./lm-eval.sh 8 g

data/results/test/sentence.8.li.answer.json:
	./lm-eval.sh 8 i

data/results/test/sentence.8.lm.answer.json:
	./lm-eval.sh 8 m

data/results/test/sentence.8.ld.answer.json:
	./lm-eval.sh 8 d

data/results/test/sentence.8.la.answer.json:
	./lm-eval.sh 8 a

data/results/test/sentence.8.lt.answer.json:
	./lm-eval.sh 8 t

data/results/test/sentence.8.lw.answer.json:
	./lm-eval.sh 8 w



data/results/test/sentence.16.lg.answer.json:
	./lm-eval.sh 16 g

data/results/test/sentence.16.li.answer.json:
	./lm-eval.sh 16 i

data/results/test/sentence.16.lm.answer.json:
	./lm-eval.sh 16 m

data/results/test/sentence.16.ld.answer.json:
	./lm-eval.sh 16 d

data/results/test/sentence.16.la.answer.json:
	./lm-eval.sh 16 a

data/results/test/sentence.16.lt.answer.json:
	./lm-eval.sh 16 t

data/results/test/sentence.16.lw.answer.json:
	./lm-eval.sh 16 w



data/results/test/sentence.32.lg.answer.json:
	./lm-eval.sh 32 g

data/results/test/sentence.32.li.answer.json:
	./lm-eval.sh 32 i

data/results/test/sentence.32.lm.answer.json:
	./lm-eval.sh 32 m

data/results/test/sentence.32.ld.answer.json:
	./lm-eval.sh 32 d

data/results/test/sentence.32.la.answer.json:
	./lm-eval.sh 32 a

data/results/test/sentence.32.lt.answer.json:
	./lm-eval.sh 32 t

data/results/test/sentence.32.lw.answer.json:
	./lm-eval.sh 32 w



data/results/test/sentence.64.lg.answer.json:
	./lm-eval.sh 64 g

data/results/test/sentence.64.li.answer.json:
	./lm-eval.sh 64 i

data/results/test/sentence.64.lm.answer.json:
	./lm-eval.sh 64 m

data/results/test/sentence.64.ld.answer.json:
	./lm-eval.sh 64 d

data/results/test/sentence.64.la.answer.json:
	./lm-eval.sh 64 a

data/results/test/sentence.64.lt.answer.json:
	./lm-eval.sh 64 t

data/results/test/sentence.64.lw.answer.json:
	./lm-eval.sh 64 w



ablation: data/results/test/sentence.2.-g.answer.json data/results/test/sentence.2.-i.answer.json data/results/test/sentence.2.-l.answer.json data/results/test/sentence.2.-m.answer.json data/results/test/sentence.2.-d.answer.json data/results/test/sentence.2.-a.answer.json data/results/test/sentence.2.-t.answer.json data/results/test/sentence.2.-w.answer.json data/results/test/sentence.4.-g.answer.json data/results/test/sentence.4.-i.answer.json data/results/test/sentence.4.-l.answer.json data/results/test/sentence.4.-m.answer.json data/results/test/sentence.4.-d.answer.json data/results/test/sentence.4.-a.answer.json data/results/test/sentence.4.-t.answer.json data/results/test/sentence.4.-w.answer.json data/results/test/sentence.8.-g.answer.json data/results/test/sentence.8.-i.answer.json data/results/test/sentence.8.-l.answer.json data/results/test/sentence.8.-m.answer.json data/results/test/sentence.8.-d.answer.json data/results/test/sentence.8.-a.answer.json data/results/test/sentence.8.-t.answer.json data/results/test/sentence.8.-w.answer.json data/results/test/sentence.16.-g.answer.json data/results/test/sentence.16.-i.answer.json data/results/test/sentence.16.-l.answer.json data/results/test/sentence.16.-m.answer.json data/results/test/sentence.16.-d.answer.json data/results/test/sentence.16.-a.answer.json data/results/test/sentence.16.-t.answer.json data/results/test/sentence.16.-w.answer.json data/results/test/sentence.32.-g.answer.json data/results/test/sentence.32.-i.answer.json data/results/test/sentence.32.-l.answer.json data/results/test/sentence.32.-m.answer.json data/results/test/sentence.32.-d.answer.json data/results/test/sentence.32.-a.answer.json data/results/test/sentence.32.-t.answer.json data/results/test/sentence.32.-w.answer.json data/results/test/sentence.64.-g.answer.json data/results/test/sentence.64.-i.answer.json data/results/test/sentence.64.-l.answer.json data/results/test/sentence.64.-m.answer.json data/results/test/sentence.64.-d.answer.json data/results/test/sentence.64.-a.answer.json data/results/test/sentence.64.-t.answer.json data/results/test/sentence.64.-w.answer.json 

feature_eval: data/results/test/sentence.2.g.answer.json data/results/test/sentence.2.i.answer.json data/results/test/sentence.2.l.answer.json data/results/test/sentence.2.m.answer.json data/results/test/sentence.2.d.answer.json data/results/test/sentence.2.a.answer.json data/results/test/sentence.2.t.answer.json data/results/test/sentence.2.w.answer.json data/results/test/sentence.4.g.answer.json data/results/test/sentence.4.i.answer.json data/results/test/sentence.4.l.answer.json data/results/test/sentence.4.m.answer.json data/results/test/sentence.4.d.answer.json data/results/test/sentence.4.a.answer.json data/results/test/sentence.4.t.answer.json data/results/test/sentence.4.w.answer.json data/results/test/sentence.8.g.answer.json data/results/test/sentence.8.i.answer.json data/results/test/sentence.8.l.answer.json data/results/test/sentence.8.m.answer.json data/results/test/sentence.8.d.answer.json data/results/test/sentence.8.a.answer.json data/results/test/sentence.8.t.answer.json data/results/test/sentence.8.w.answer.json data/results/test/sentence.16.g.answer.json data/results/test/sentence.16.i.answer.json data/results/test/sentence.16.l.answer.json data/results/test/sentence.16.m.answer.json data/results/test/sentence.16.d.answer.json data/results/test/sentence.16.a.answer.json data/results/test/sentence.16.t.answer.json data/results/test/sentence.16.w.answer.json data/results/test/sentence.32.g.answer.json data/results/test/sentence.32.i.answer.json data/results/test/sentence.32.l.answer.json data/results/test/sentence.32.m.answer.json data/results/test/sentence.32.d.answer.json data/results/test/sentence.32.a.answer.json data/results/test/sentence.32.t.answer.json data/results/test/sentence.32.w.answer.json data/results/test/sentence.64.g.answer.json data/results/test/sentence.64.i.answer.json data/results/test/sentence.64.l.answer.json data/results/test/sentence.64.m.answer.json data/results/test/sentence.64.d.answer.json data/results/test/sentence.64.a.answer.json data/results/test/sentence.64.t.answer.json data/results/test/sentence.64.w.answer.json 

lm_eval: data/results/test/sentence.2.lg.answer.json data/results/test/sentence.2.li.answer.json data/results/test/sentence.2.lm.answer.json data/results/test/sentence.2.ld.answer.json data/results/test/sentence.2.la.answer.json data/results/test/sentence.2.lt.answer.json data/results/test/sentence.2.lw.answer.json data/results/test/sentence.4.lg.answer.json data/results/test/sentence.4.li.answer.json data/results/test/sentence.4.lm.answer.json data/results/test/sentence.4.ld.answer.json data/results/test/sentence.4.la.answer.json data/results/test/sentence.4.lt.answer.json data/results/test/sentence.4.lw.answer.json data/results/test/sentence.8.lg.answer.json data/results/test/sentence.8.li.answer.json data/results/test/sentence.8.lm.answer.json data/results/test/sentence.8.ld.answer.json data/results/test/sentence.8.la.answer.json data/results/test/sentence.8.lt.answer.json data/results/test/sentence.8.lw.answer.json data/results/test/sentence.16.lg.answer.json data/results/test/sentence.16.li.answer.json data/results/test/sentence.16.lm.answer.json data/results/test/sentence.16.ld.answer.json data/results/test/sentence.16.la.answer.json data/results/test/sentence.16.lt.answer.json data/results/test/sentence.16.lw.answer.json data/results/test/sentence.32.lg.answer.json data/results/test/sentence.32.li.answer.json data/results/test/sentence.32.lm.answer.json data/results/test/sentence.32.ld.answer.json data/results/test/sentence.32.la.answer.json data/results/test/sentence.32.lt.answer.json data/results/test/sentence.32.lw.answer.json data/results/test/sentence.64.lg.answer.json data/results/test/sentence.64.li.answer.json data/results/test/sentence.64.lm.answer.json data/results/test/sentence.64.ld.answer.json data/results/test/sentence.64.la.answer.json data/results/test/sentence.64.lt.answer.json data/results/test/sentence.64.lw.answer.json 

# Train all of the models

all_sentence_models: data/models/sentence.full.2.vw data/models/sentence.full.4.vw data/models/sentence.full.8.vw data/models/sentence.full.16.vw data/models/sentence.full.32.vw data/models/sentence.full.64.vw

# Buzz predictions for all models

all_sentence_buzz: data/results/dev/sentence.2.summary.json data/results/devtest/sentence.2.summary.json data/results/test/sentence.2.summary.json data/results/dev/sentence.4.summary.json data/results/devtest/sentence.4.summary.json data/results/test/sentence.4.summary.json data/results/dev/sentence.8.summary.json data/results/devtest/sentence.8.summary.json data/results/test/sentence.8.summary.json data/results/dev/sentence.16.summary.json data/results/devtest/sentence.16.summary.json data/results/test/sentence.16.summary.json data/results/dev/sentence.32.summary.json data/results/devtest/sentence.32.summary.json data/results/test/sentence.32.summary.json data/results/dev/sentence.64.summary.json data/results/devtest/sentence.64.summary.json data/results/test/sentence.64.summary.json

# Get performance summaries
data/results/dev.sentence.csv: data/results/dev/sentence.2.full.buzz data/results/dev/sentence.4.full.buzz data/results/dev/sentence.8.full.buzz data/results/dev/sentence.16.full.buzz data/results/dev/sentence.32.full.buzz data/results/dev/sentence.64.full.buzz reporting/summarize.py
	python3 reporting/summarize.py --output $@ -p data/results/dev/sentence.2.full.perf data/results/dev/sentence.4.full.perf data/results/dev/sentence.8.full.perf data/results/dev/sentence.16.full.perf data/results/dev/sentence.32.full.perf data/results/dev/sentence.64.full.perf

data/results/devtest.sentence.csv: data/results/devtest/sentence.2.full.buzz data/results/devtest/sentence.4.full.buzz data/results/devtest/sentence.8.full.buzz data/results/devtest/sentence.16.full.buzz data/results/devtest/sentence.32.full.buzz data/results/devtest/sentence.64.full.buzz reporting/summarize.py
	python3 reporting/summarize.py --output $@ -p data/results/devtest/sentence.2.full.perf data/results/devtest/sentence.4.full.perf data/results/devtest/sentence.8.full.perf data/results/devtest/sentence.16.full.perf data/results/devtest/sentence.32.full.perf data/results/devtest/sentence.64.full.perf

data/results/test.sentence.csv: data/results/test/sentence.2.full.buzz data/results/test/sentence.4.full.buzz data/results/test/sentence.8.full.buzz data/results/test/sentence.16.full.buzz data/results/test/sentence.32.full.buzz data/results/test/sentence.64.full.buzz reporting/summarize.py
	python3 reporting/summarize.py --output $@ -p data/results/test/sentence.2.full.perf data/results/test/sentence.4.full.perf data/results/test/sentence.8.full.perf data/results/test/sentence.16.full.perf data/results/test/sentence.32.full.perf data/results/test/sentence.64.full.perf

data/results/dev.sentence.pdf: data/results/dev.sentence.csv
	Rscript reporting/running_score.R $< $@

data/results/devtest.sentence.pdf: data/results/devtest.sentence.csv
	Rscript reporting/running_score.R $< $@

data/results/test.sentence.pdf: data/results/test.sentence.csv
	Rscript reporting/running_score.R $< $@

data/results/sentence.features_cont.csv data/results/sentence.features_disc.csv: util/inspect_features.py data/features/dev/sentence.ir.feat data/features/dev/sentence.lm.feat data/features/dev/sentence.deep.feat data/features/dev/sentence.answer_present.feat data/features/dev/sentence.classifier.feat data/features/dev/sentence.wikilinks.feat data/features/dev/sentence.mentions.feat
	python3 util/inspect_features.py --feats data/features/dev/sentence.ir.feat data/features/dev/sentence.lm.feat data/features/dev/sentence.deep.feat data/features/dev/sentence.answer_present.feat data/features/dev/sentence.classifier.feat data/features/dev/sentence.wikilinks.feat data/features/dev/sentence.mentions.feat --label data/features/dev/sentence.label.feat --output_cont data/results/sentence.features_cont.csv --output_disc data/results/sentence.features_disc.csv

data/results/sentence.features_disc.pdf results/sentence.features_cont.pdf: data/results/sentence.features_cont.csv results/sentence.features_disc.csv util/density_plots.R
	Rscript util/density_plots.R sentence

data/wikifier/data/expo_input: data/expo.csv util/wikification.py
	rm -rf $@
	mkdir -p $@
	python util/wikification.py --output_directory=$@ --database='' --min_pages=-1 --expo=data/expo.csv

data/wikifier/data/expo_output: data/wikifier/data/expo_input
	rm -rf $@
	mkdir -p $@
	(cd data/wikifier && java -Xmx10G -jar ../../lib/wikifier-3.0-jar-with-dependencies.jar -annotateData data/expo_input data/expo_output false ../../lib/STAND_ALONE_GUROBI.xml)
	cp $@/* data/wikifier/data/output

features/expo/word.label.feat: extract_expo_features.py data/classifier/ans_type.pkl data/classifier/category.pkl data/classifier/gender.pkl data/deep/params data/ir/whoosh_qb_5 data/ir/whoosh_wiki_5 data/kenlm.binary data/lm.txt data/wikifier/data/output data/wikifier/data/expo_output
	mkdir -p features/expo
	mkdir -p results/expo
	rm -f data/expo_guess.db
	python extract_expo_features.py

features/expo/word.label.2 features/expo/word.label.4 features/expo/word.label.8 features/expo/word.label.16 features/expo/word.label.32 features/expo/word.label.64: features/expo/word.label.feat
	python util/reweight_labels.py $<

features/expo/expo.2.vw_input: features/expo/word.label.2
	paste features/expo/word.label.2 features/expo/word.ir.feat features/expo/word.lm.feat features/expo/word.deep.feat features/expo/word.answer_present.feat features/expo/word.classifier.feat features/expo/word.wikilinks.feat features/expo/word.mentions.feat| gzip > $@

features/expo/expo.4.vw_input: features/expo/word.label.4
	paste features/expo/word.label.4 features/expo/word.ir.feat features/expo/word.lm.feat features/expo/word.deep.feat features/expo/word.answer_present.feat features/expo/word.classifier.feat features/expo/word.wikilinks.feat features/expo/word.mentions.feat| gzip > $@

features/expo/expo.8.vw_input: features/expo/word.label.8
	paste features/expo/word.label.8 features/expo/word.ir.feat features/expo/word.lm.feat features/expo/word.deep.feat features/expo/word.answer_present.feat features/expo/word.classifier.feat features/expo/word.wikilinks.feat features/expo/word.mentions.feat| gzip > $@

features/expo/expo.16.vw_input: features/expo/word.label.16
	paste features/expo/word.label.16 features/expo/word.ir.feat features/expo/word.lm.feat features/expo/word.deep.feat features/expo/word.answer_present.feat features/expo/word.classifier.feat features/expo/word.wikilinks.feat features/expo/word.mentions.feat| gzip > $@

features/expo/expo.32.vw_input: features/expo/word.label.32
	paste features/expo/word.label.32 features/expo/word.ir.feat features/expo/word.lm.feat features/expo/word.deep.feat features/expo/word.answer_present.feat features/expo/word.classifier.feat features/expo/word.wikilinks.feat features/expo/word.mentions.feat| gzip > $@

features/expo/expo.64.vw_input: features/expo/word.label.64
	paste features/expo/word.label.64 features/expo/word.ir.feat features/expo/word.lm.feat features/expo/word.deep.feat features/expo/word.answer_present.feat features/expo/word.classifier.feat features/expo/word.wikilinks.feat features/expo/word.mentions.feat| gzip > $@

results/expo/expo.2.pred: features/expo/expo.2.vw_input models/sentence.full.2.vw
	vw --compressed -t -d features/expo/expo.2.vw_input -i models/sentence.full.2.vw  -p $@

results/expo/expo.2.buzz: results/expo/expo.2.pred
	mkdir -p results/expo
	python reporting/evaluate_predictions.py --buzzes=$@ --qbdb=data/questions.db --question_out='' --meta=features/expo/word.meta --perf=results/expo/word.2.full.perf --neg_weight=2.000000 --vw_config=full --expo=data/expo.csv --finals=results/expo/expo.2.final --pred=$<

results/expo/expo.4.pred: features/expo/expo.4.vw_input models/sentence.full.4.vw
	vw --compressed -t -d features/expo/expo.4.vw_input -i models/sentence.full.4.vw  -p $@

results/expo/expo.4.buzz: results/expo/expo.4.pred
	mkdir -p results/expo
	python reporting/evaluate_predictions.py --buzzes=$@ --qbdb=data/questions.db --question_out='' --meta=features/expo/word.meta --perf=results/expo/word.4.full.perf --neg_weight=4.000000 --vw_config=full --expo=data/expo.csv --finals=results/expo/expo.4.final --pred=$<

results/expo/expo.8.pred: features/expo/expo.8.vw_input models/sentence.full.8.vw
	vw --compressed -t -d features/expo/expo.8.vw_input -i models/sentence.full.8.vw  -p $@

results/expo/expo.8.buzz: results/expo/expo.8.pred
	mkdir -p results/expo
	python reporting/evaluate_predictions.py --buzzes=$@ --qbdb=data/questions.db --question_out='' --meta=features/expo/word.meta --perf=results/expo/word.8.full.perf --neg_weight=8.000000 --vw_config=full --expo=data/expo.csv --finals=results/expo/expo.8.final --pred=$<

results/expo/expo.16.pred: features/expo/expo.16.vw_input models/sentence.full.16.vw
	vw --compressed -t -d features/expo/expo.16.vw_input -i models/sentence.full.16.vw  -p $@

results/expo/expo.16.buzz: results/expo/expo.16.pred
	mkdir -p results/expo
	python reporting/evaluate_predictions.py --buzzes=$@ --qbdb=data/questions.db --question_out='' --meta=features/expo/word.meta --perf=results/expo/word.16.full.perf --neg_weight=16.000000 --vw_config=full --expo=data/expo.csv --finals=results/expo/expo.16.final --pred=$<

results/expo/expo.32.pred: features/expo/expo.32.vw_input models/sentence.full.32.vw
	vw --compressed -t -d features/expo/expo.32.vw_input -i models/sentence.full.32.vw  -p $@

results/expo/expo.32.buzz: results/expo/expo.32.pred
	mkdir -p results/expo
	python reporting/evaluate_predictions.py --buzzes=$@ --qbdb=data/questions.db --question_out='' --meta=features/expo/word.meta --perf=results/expo/word.32.full.perf --neg_weight=32.000000 --vw_config=full --expo=data/expo.csv --finals=results/expo/expo.32.final --pred=$<

results/expo/expo.64.pred: features/expo/expo.64.vw_input models/sentence.full.64.vw
	vw --compressed -t -d features/expo/expo.64.vw_input -i models/sentence.full.64.vw  -p $@

results/expo/expo.64.buzz: results/expo/expo.64.pred
	mkdir -p results/expo
	python reporting/evaluate_predictions.py --buzzes=$@ --qbdb=data/questions.db --question_out='' --meta=features/expo/word.meta --perf=results/expo/word.64.full.perf --neg_weight=64.000000 --vw_config=full --expo=data/expo.csv --finals=results/expo/expo.64.final --pred=$<

demo2: results/expo/expo.2.buzz
	python util/buzzer.py --questions=results/expo/questions.csv --buzzes=results/expo/expo.2.buzz --output=results/expo/competition.csv --finals=results/expo/expo.2.final --power=data/expo_power.csv

demo4: results/expo/expo.4.buzz
	python util/buzzer.py --questions=results/expo/questions.csv --buzzes=results/expo/expo.4.buzz --output=results/expo/competition.csv --finals=results/expo/expo.4.final --power=data/expo_power.csv

demo8: results/expo/expo.8.buzz
	python util/buzzer.py --questions=results/expo/questions.csv --buzzes=results/expo/expo.8.buzz --output=results/expo/competition.csv --finals=results/expo/expo.8.final --power=data/expo_power.csv

demo16: results/expo/expo.16.buzz
	python util/buzzer.py --questions=results/expo/questions.csv --buzzes=results/expo/expo.16.buzz --output=results/expo/competition.csv --finals=results/expo/expo.16.final --power=data/expo_power.csv

demo32: results/expo/expo.32.buzz
	python util/buzzer.py --questions=results/expo/questions.csv --buzzes=results/expo/expo.32.buzz --output=results/expo/competition.csv --finals=results/expo/expo.32.final --power=data/expo_power.csv

demo64: results/expo/expo.64.buzz
	python util/buzzer.py --questions=results/expo/questions.csv --buzzes=results/expo/expo.64.buzz --output=results/expo/competition.csv --finals=results/expo/expo.64.final --power=data/expo_power.csv



clean:
	rm -rf data/guesses.db features data/deep/params
	rm -rf data/classifier/*.pkl data/wikifier/data/input data/wikifier/data/output